(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["admin"],{"07ac":function(t,e,s){var a=s("23e7"),i=s("6f53").values;a({target:"Object",stat:!0},{values:function(t){return i(t)}})},"13d5":function(t,e,s){"use strict";var a=s("23e7"),i=s("d58f").left,n=s("a640"),l=s("ae40"),r=n("reduce"),o=l("reduce",{1:0});a({target:"Array",proto:!0,forced:!r||!o},{reduce:function(t){return i(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}})},3530:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"admin"},[s("crud-modal",{attrs:{"is-open":t.isOpen,api:t.itemAPI,fields:t.itemFields,item:t.itemSelected},on:{close:function(e){t.isOpen=!1}}}),s("section",{staticClass:"container"},[s("div",{staticClass:"columns is-centered"},[s("div",{staticClass:"column is-12 has-text-left"},[s("div",{staticClass:"box"},[s("p",{staticClass:"is-size-4 has-text-centered has-text-weight-bold"},[t._v(" Admin ")]),s("div",[t._v(" Recent activity: ")]),s("div",{staticClass:"admin__activity box"},t._l(t.activity,(function(e,a){return s("div",{key:a,staticClass:"activity__item"},[t._v(" "+t._s(e.time)+" - "+t._s(e.user)+" - "+t._s(e.msg)+" ")])})),0),s("b-tabs",{attrs:{type:"is-toggle",expanded:""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[s("b-tab-item",{attrs:{label:t.usersLabel,value:t.tabs[0]}},[s("div",{staticClass:"is-flex flex-space-between mb-2"},[s("span",[t._v("Selected id: "+t._s(t.users.selected?t.users.selected.id:"none")+" ")]),s("label",[t._v(" JSON: "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.users.query,expression:"users.query"}],attrs:{type:"text"},domProps:{value:t.users.query},on:{change:t.getItems,input:function(e){e.target.composing||t.$set(t.users,"query",e.target.value)}}})]),s("div",{staticClass:"buttons"},[s("b-button",{attrs:{size:"is-small",disabled:!t.users.selected},on:{click:function(e){t.isOpen=!t.isOpen}}},[t._v(" Edit ")])],1)]),s("b-table",{attrs:{striped:"",scrollable:"",data:t.users.data,columns:t.users.columns,selected:t.users.selected},on:{"update:selected":function(e){return t.$set(t.users,"selected",e)}}})],1),s("b-tab-item",{attrs:{label:t.projectsLabel,value:t.tabs[1]},on:{click:function(e){t.isOpen=!t.isOpen}}},[s("div",{staticClass:"is-flex flex-space-between mb-2"},[s("span",[t._v("Selected id: "+t._s(t.projects.selected?t.projects.selected.id:"none")+" ")]),s("label",[t._v(" JSON: "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.projects.query,expression:"projects.query"}],attrs:{type:"text"},domProps:{value:t.projects.query},on:{change:t.getItems,input:function(e){e.target.composing||t.$set(t.projects,"query",e.target.value)}}})]),s("div",{staticClass:"buttons"},[s("b-button",{attrs:{size:"is-small",disabled:!t.projects.selected},on:{click:function(e){t.isOpen=!t.isOpen}}},[t._v(" Edit ")])],1)]),s("b-table",{attrs:{striped:"",scrollable:"",data:t.projects.data,columns:t.projects.columns,selected:t.projects.selected},on:{"update:selected":function(e){return t.$set(t.projects,"selected",e)}}})],1),s("b-tab-item",{attrs:{label:t.plansLabel,value:t.tabs[2]},on:{click:function(e){t.isOpen=!t.isOpen}}},[s("div",{staticClass:"is-flex flex-space-between mb-2"},[s("span",[t._v("Selected id: "+t._s(t.plans.selected?t.plans.selected.id:"none")+" ")]),s("label",[t._v(" JSON: "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.plans.query,expression:"plans.query"}],attrs:{type:"text"},domProps:{value:t.plans.query},on:{change:t.getItems,input:function(e){e.target.composing||t.$set(t.plans,"query",e.target.value)}}})]),s("div",{staticClass:"buttons"},[s("b-button",{attrs:{size:"is-small",disabled:!t.plans.selected},on:{click:function(e){t.isOpen=!t.isOpen}}},[t._v(" Edit ")])],1)]),s("b-table",{attrs:{striped:"",scrollable:"",data:t.plans.data,columns:t.plans.columns,selected:t.plans.selected},on:{"update:selected":function(e){return t.$set(t.plans,"selected",e)}}})],1),s("b-tab-item",{attrs:{label:t.tasksLabel,value:t.tabs[3]},on:{click:function(e){t.isOpen=!t.isOpen}}},[s("div",{staticClass:"is-flex flex-space-between mb-2"},[s("span",[t._v("Selected id: "+t._s(t.tasks.selected?t.tasks.selected.id:"none")+" ")]),s("label",[t._v(" JSON: "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.tasks.query,expression:"tasks.query"}],attrs:{type:"text"},domProps:{value:t.tasks.query},on:{change:t.getItems,input:function(e){e.target.composing||t.$set(t.tasks,"query",e.target.value)}}})]),s("div",{staticClass:"buttons"},[s("b-button",{attrs:{size:"is-small",disabled:!t.tasks.selected},on:{click:function(e){t.isOpen=!t.isOpen}}},[t._v(" Edit ")])],1)]),s("b-table",{attrs:{striped:"",scrollable:"",data:t.tasks.data,columns:t.tasks.columns,selected:t.tasks.selected},on:{"update:selected":function(e){return t.$set(t.tasks,"selected",e)}}})],1)],1),s("b-pagination",{attrs:{simple:"",total:t.pageTotals,"per-page":t.perPage},model:{value:t.pageCurrent,callback:function(e){t.pageCurrent=e},expression:"pageCurrent"}},[s("b-button",{staticClass:"previous",attrs:{slot:"previous",disabled:t.pageCurrent<=1},on:{click:function(e){t.pageCurrent=t.pageCurrent-1}},slot:"previous"},[t._v(" < ")]),s("b-button",{staticClass:"mr-4 next",attrs:{slot:"next",disabled:t.pageCurrent>t.pageMax},on:{click:function(e){t.pageCurrent=t.pageCurrent+1}},slot:"next"},[t._v(" > ")])],1)],1)])])])],1)},i=[],n=(s("4de4"),s("4160"),s("13d5"),s("d3b7"),s("07ac"),s("25f0"),s("3ca3"),s("159b"),s("ddb0"),s("c0dc")),l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-modal",{attrs:{"has-modal-card":"","trap-focus":"","aria-modal":"","aria-role":"dialog",active:t.isOpen,canCancel:!1,"destroy-on-hide":!1},on:{close:function(e){return t.$emit("close",!0)}}},[s("form",{on:{submit:function(e){return e.preventDefault(),t.onSubmit(e)}}},[s("div",{staticClass:"modal-card"},[s("header",{staticClass:"modal-card-head"},[s("p",{staticClass:"modal-card-title"},[t._v("Edit")]),s("button",{staticClass:"delete",attrs:{type:"button"},on:{click:function(e){return t.$emit("close")}}})]),t.item?s("section",{staticClass:"modal-card-body"},t._l(t.fields,(function(e){return s("b-field",{attrs:{label:e.label}},[s("b-input",{attrs:{type:"string",placeholder:t.item[e.field]},model:{value:t.item[e.field],callback:function(s){t.$set(t.item,e.field,s)},expression:"item[field.field]"}})],1)})),1):t._e(),s("footer",{staticClass:"modal-card-foot"},[s("button",{staticClass:"button is-danger",attrs:{type:"button"},on:{click:t.onDelete}},[t._v(" Delete ")]),s("div",{staticClass:"flex-grow"}),s("button",{staticClass:"button",attrs:{type:"button"},on:{click:function(e){return t.$emit("close")}}},[t._v(" Close ")]),s("button",{staticClass:"button is-primary",attrs:{disabled:!t.hasDiff},on:{click:t.onSubmit}},[t._v(" Save ")])])])])])},r=[],o=(s("99af"),s("ec41")),c=function(){return{}},u={name:"crudModal",components:{},data:function(){return{itemDiff:"",isLoading:!1}},props:{isOpen:{type:Boolean,default:!1},fields:{type:Array,default:[]},api:{type:Object,default:c},item:{type:Object,default:c}},computed:{hasDiff:function(){return this.item?this.itemDiff!==Object.values(this.item).toString():""}},watch:{isOpen:function(){this.reset()}},methods:{reset:function(){this.itemDiff=Object.values(this.item).toString(),this.isLoading=!1},onDelete:function(){var t=this;if(!this.isLoading)return this.isLoading=!0,n["a"].remove("".concat(this.api.DELETE,"/").concat(this.item.id)).then((function(e){t.onSuccess(e),t.$emit("close",!0)})).catch((function(e){return t.onError(e)})).finally((function(){t.isLoading=!1}))},onSubmit:function(){var t=this;if(this.hasDiff&&!this.isLoading)return this.isLoading=!0,n["a"].put("".concat(this.api.PATCH,"/").concat(this.item.id),this.item).then((function(e){return t.onSuccess(e)})).catch((function(e){return t.onError(e)}))},onSuccess:function(t){this.isLoading=!1,this.$buefy.toast.open({duration:1500,message:Object(o["a"])(t,"data.message","success"),position:"is-top",type:"is-success"})},onError:function(t){throw this.$buefy.toast.open({duration:5e3,message:Object(o["a"])(t,"response.data.message","error"),position:"is-top",type:"is-danger"}),t}}},d=u,p=s("2877"),f=Object(p["a"])(d,l,r,!1,null,null,null),b=f.exports,m=s("5a50"),g={API:{GET:"/api/users",PATCH:"/api/users",DELETE:"/api/users"},text:"users"},h={PROJECT:m["h"],PLAN:m["g"],TASK:m["j"],USER:g},v={name:"Admin",components:{crudModal:b},data:function(){return{socketFunc:null,tab:"users",tabs:["users","projects","plans","tasks"],perPage:20,skip:0,isOpen:!1,totals:{projects:0,plans:0,tasks:0,users:0},activity:[],projects:{loading:!1,query:"",page:1,total:0,data:[],columns:[{field:"id",label:"ID"},{field:"owner",label:"Owner"},{field:"progress",label:"Progress"},{field:"total",label:"Total"},{field:"is_done",label:"isDone"},{field:"done_at",label:"Done"},{field:"created_at",label:"Created"},{field:"updated_at",label:"Updated"},{field:"value",label:"Value"}]},plans:{loading:!1,query:"",page:1,total:0,data:[],columns:[{field:"id",label:"ID"},{field:"owner",label:"Owner"},{field:"project",label:"Project"},{field:"progress",label:"Progress"},{field:"total",label:"Total"},{field:"is_done",label:"isDone"},{field:"done_at",label:"Done"},{field:"created_at",label:"Created"},{field:"updated_at",label:"Updated"},{field:"value",label:"Value"}]},tasks:{loading:!1,query:"",page:1,total:0,data:[],columns:[{field:"id",label:"ID"},{field:"owner",label:"Owner"},{field:"project",label:"Project"},{field:"plan",label:"Plan"},{field:"progress",label:"Progress"},{field:"total",label:"Total"},{field:"is_done",label:"isDone"},{field:"done_at",label:"Done"},{field:"created_at",label:"Created"},{field:"updated_at",label:"Updated"},{field:"value",label:"Value"}]},users:{loading:!1,query:"",page:1,total:0,selected:null,data:[],columns:[{field:"id",label:"ID"},{field:"role",label:"Role"},{field:"email",label:"Email"},{field:"login_at",label:"Login"},{field:"created_at",label:"Created"},{field:"updated_at",label:"Updated"}]}}},computed:{itemAPI:function(){var t=this;return Object.values(h).filter((function(e){return e.text===t.tab}))[0].API},itemFields:function(){return this[this.tab].columns},itemSelected:function(){return this[this.tab].selected},pageTotals:function(){return this[this.tab].total},pageCurrent:{get:function(){return this[this.tab].page},set:function(t){this[this.tab].page=t}},pageMax:function(){return Math.floor(this[this.tab].total/this.perPage)},projectsLabel:function(){return"Projects (".concat(this.totals.projects,")")},plansLabel:function(){return"Plans (".concat(this.totals.plans,")")},tasksLabel:function(){return"Tasks (".concat(this.totals.tasks,")")},usersLabel:function(){return"Users (".concat(this.totals.users,")")}},watch:{tab:{handler:function(){return this.skip=0,this.pageCurrent=1,this.getItems()},immediate:!0},pageCurrent:function(){return this.getItems()}},created:function(){var t=this;return this.getTotals().then((function(){return n["a"].get("/api/adminlatest").then((function(e){var s=e.data;t.activity=s.data}))}))},methods:{getItems:function(){return this.tab===this.tabs[1]?this.getWrapper(m["h"]):this.tab===this.tabs[2]?this.getWrapper(m["g"]):this.tab===this.tabs[3]?this.getWrapper(m["j"]):this.getWrapper(g)},getTotals:function(){var t=this,e={params:{$limit:0,showAll:!0}},s=[];return[m["h"],m["g"],m["j"],g].forEach((function(a){s.push(n["a"].get(a.API.GET,e).then((function(e){var s=e.data;t.totals[a.text]=s.total})))})),Promise.all(s)},getWrapper:function(t){var e=this;if(!this[t.text].loading){var s={params:{$limit:20,$skip:(this.pageCurrent-1)*this.perPage,showAll:!0}};return this[t.text].query.toString().length>0&&(s.params=Object.assign(s.params,JSON.parse(this[t.text].query))),this[t.text].loading=!0,n["a"].get(t.API.GET,s).then((function(s){var a=s.data;e[e.tab].total=a.total,e[t.text].data=a.data.reduce((function(t,s){return s.login_at&&(s.login_at=e.$options.filters.itemLogin(s,!0,!0,!0)),s.created_at&&(s.created_at=e.$options.filters.itemDate(s,!0,!0,!0)),s.updated_at&&(s.updated_at=e.$options.filters.itemUpdate(s,!0,!0,!0)),s.done_at&&(s.done_at=e.$options.filters.itemDone(s,!0,!0,!0)),t.push(s),t}),[])})).finally((function(){return e[t.text].loading=!1}))}}}},_=v,y=Object(p["a"])(_,a,i,!1,null,null,null);e["default"]=y.exports},d58f:function(t,e,s){var a=s("1c0b"),i=s("7b0b"),n=s("44ad"),l=s("50c4"),r=function(t){return function(e,s,r,o){a(s);var c=i(e),u=n(c),d=l(c.length),p=t?d-1:0,f=t?-1:1;if(r<2)while(1){if(p in u){o=u[p],p+=f;break}if(p+=f,t?p<0:d<=p)throw TypeError("Reduce of empty array with no initial value")}for(;t?p>=0:d>p;p+=f)p in u&&(o=s(o,u[p],p,c));return o}};t.exports={left:r(!1),right:r(!0)}}}]);